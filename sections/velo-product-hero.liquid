{{ 'velo-product-hero.css' | asset_url | stylesheet_tag }}

{%- assign current_product = section.settings.product -%}

<div class="velo-hero-wrapper">
  <div class="velo-hero-container page-width">
    <!-- Left Column: Media Gallery -->
    <div class="velo-media-gallery" id="veloMediaGallery-{{ section.id }}">
      {% if current_product != blank and current_product.media.size > 0 %}
        <div class="velo-media-grid">
          {% for media in current_product.media %}
            <div class="velo-media-item {% if forloop.first %}velo-media-item--featured{% endif %}" data-media-id="{{ media.id }}">
              {% case media.media_type %}
                {% when 'image' %}
                  <img
                    src="{{ media | image_url: width: 800 }}"
                    alt="{{ media.alt | escape }}"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                    width="{{ media.width }}"
                    height="{{ media.height }}"
                    srcset="
                      {{ media | image_url: width: 400 }} 400w,
                      {{ media | image_url: width: 600 }} 600w,
                      {{ media | image_url: width: 800 }} 800w
                    "
                    sizes="(min-width: 990px) 50vw, 100vw"
                  >
                {% when 'video' %}
                  <div class="velo-video-wrapper">
                    {{ media | video_tag: autoplay: true, muted: true, loop: true, playsinline: true, controls: false }}
                  </div>
                {% when 'external_video' %}
                  <div class="velo-video-wrapper">
                    {{ media | external_video_url: autoplay: true, loop: true, mute: true | external_video_tag }}
                  </div>
              {% endcase %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- Placeholder images when no product selected (Demo Setup) -->
        <div class="velo-media-grid">
          <div class="velo-media-item velo-media-item--featured">
            {% if section.settings.image_1 != blank %}
              <img src="{{ section.settings.image_1 | image_url: width: 800 }}" alt="{{ section.settings.image_1.alt }}" width="800" height="800" loading="eager" />
            {% else %}
              <img src="https://images.unsplash.com/photo-1505693314120-0d443867891c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Mattress Topper 1" width="800" height="800" loading="eager" />
            {% endif %}
          </div>
          <div class="velo-media-item">
            {% if section.settings.image_2 != blank %}
              <img src="{{ section.settings.image_2 | image_url: width: 400 }}" alt="{{ section.settings.image_2.alt }}" width="400" height="400" loading="lazy" />
            {% else %}
              <img src="https://images.unsplash.com/photo-1631679706909-1844bbd07221?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Mattress Topper 2" width="400" height="400" loading="lazy" />
            {% endif %}
          </div>
          <div class="velo-media-item">
            {% if section.settings.image_3 != blank %}
              <img src="{{ section.settings.image_3 | image_url: width: 400 }}" alt="{{ section.settings.image_3.alt }}" width="400" height="400" loading="lazy" />
            {% else %}
              <img src="https://images.unsplash.com/photo-1540518614846-7eded433c457?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Mattress Topper 3" width="400" height="400" loading="lazy" />
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Right Column: Sticky Buy Box -->
    <div class="velo-buy-box" id="veloBuyBox-{{ section.id }}">
      <div class="velo-buy-box-inner">
        <!-- Badges -->
        <div class="velo-badges">
          {% if section.settings.badge_1 != blank %}
            <span class="velo-badge velo-badge--primary">{{ section.settings.badge_1 }}</span>
          {% endif %}
          {% if section.settings.badge_2 != blank %}
            <span class="velo-badge velo-badge--secondary">{{ section.settings.badge_2 }}</span>
          {% endif %}
        </div>

        <!-- Review Stars -->
        {% if section.settings.show_reviews %}
          <div class="velo-rating">
            <div class="velo-stars">
              {% for i in (1..5) %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if i <= section.settings.rating_value %}#DDA75B{% else %}#E0E0E0{% endif %}">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              {% endfor %}
            </div>
            <span class="velo-rating-text">{{ section.settings.rating_value | append: ".0" }} | {{ section.settings.review_count }} reviews</span>
          </div>
        {% endif %}

        <!-- Product Title -->
        <h1 class="velo-product-title">
          {% if current_product != blank %}
            {{ current_product.title }}
          {% else %}
            {{ section.settings.title_fallback | default: 'VELO Freedom Chair' }}
          {% endif %}
        </h1>

        <!-- Pricing -->
        <div class="velo-pricing">
          {% if current_product != blank %}
            {% if current_product.compare_at_price > current_product.price %}
              <span class="velo-price-compare">{{ current_product.compare_at_price | money }}</span>
            {% endif %}
            <span class="velo-price-current" id="veloPrice-{{ section.id }}">{{ current_product.price | money }}</span>
            {% if current_product.compare_at_price > current_product.price %}
              {%- assign savings = current_product.compare_at_price | minus: current_product.price -%}
              <span class="velo-save-badge">SAVE {{ savings | money }}</span>
            {% endif %}
          {% else %}
            <span class="velo-price-compare">{{ section.settings.compare_price_fallback | default: '$600.00' }}</span>
            <span class="velo-price-current">{{ section.settings.price_fallback | default: '$397.00' }}</span>
            <span class="velo-save-badge">SAVE {{ section.settings.save_amount_fallback | default: '$203' }}</span>
          {% endif %}
        </div>

        <!-- Trust Note -->
        {% if section.settings.trust_note != blank %}
          <div class="velo-trust-note">
            {% render 'velo-icons', icon: 'lock' %}
            {{ section.settings.trust_note | replace: '[shop_name]', shop.name }}
          </div>
        {% endif %}

        <!-- Product Description / Bullets -->
        <div class="velo-description-text">
          {{ section.settings.hero_desc | default: "The only chair that supports your body's natural need for movement - working with your body, not against it." }}
        </div>
        
        {% if section.settings.bullet_1 != blank or section.settings.bullet_2 != blank or section.settings.bullet_3 != blank %}
          <ul class="velo-bullets">
            {% if section.settings.bullet_1 != blank %}
              <li>
                {% render 'velo-icons', icon: 'check' %}
                {{ section.settings.bullet_1 | replace: ':', ':</strong>' | prepend: '<strong>' }}
              </li>
            {% endif %}
            {% if section.settings.bullet_2 != blank %}
              <li>
                {% render 'velo-icons', icon: 'check' %}
                {{ section.settings.bullet_2 | replace: ':', ':</strong>' | prepend: '<strong>' }}
              </li>
            {% endif %}
            {% if section.settings.bullet_3 != blank %}
              <li>
                {% render 'velo-icons', icon: 'check' %}
                {{ section.settings.bullet_3 | replace: ':', ':</strong>' | prepend: '<strong>' }}
              </li>
            {% endif %}
          </ul>
        {% endif %}

        {% if current_product != blank %}
          {% form 'product', current_product %}
            
            <!-- Variant Selection -->
            {% unless current_product.has_only_default_variant %}
              <div class="velo-variants">
                {% for option in current_product.options_with_values %}
                  <div class="velo-option-group">
                    <label class="velo-option-label">{{ option.name }}: <span id="veloOptionLabel-{{ section.id }}-{{ forloop.index0 }}">{{ option.selected_value }}</span></label>
                    <div class="velo-option-values">
                      {% for value in option.values %}
                        <label class="velo-swatch {% if option.selected_value == value %}velo-swatch--active{% endif %}" data-color="{{ value | escape }}">
                          <input
                            type="radio"
                            name="option-{{ option.name | handleize }}"
                            value="{{ value | escape }}"
                            {% if option.selected_value == value %}checked{% endif %}
                            data-option-index="{{ forloop.parentloop.index0 }}"
                            class="velo-swatch-input"
                          >
                          <span class="velo-swatch-inner"></span>
                        </label>
                      {% endfor %}
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endunless %}

            <input type="hidden" name="id" id="veloVariantId-{{ section.id }}" value="{{ current_product.selected_or_first_available_variant.id }}">

            <!-- Variant JSON -->
            <script type="application/json" id="veloVariantJson-{{ section.id }}">
              {{ current_product.variants | json }}
            </script>

            <!-- Free Gifts Section -->
            {%- assign gift_blocks = section.blocks | where: 'type', 'gift' -%}
            {% if gift_blocks.size > 0 %}
              <div class="velo-gifts">
                <h3 class="velo-gifts-heading">
                  {{ section.settings.gifts_heading | default: 'Limited Sale! Unlock FREE Gifts With Your Order' }}
                </h3>
                <div class="velo-gifts-grid">
                  {% for block in gift_blocks %}
                    <div class="velo-gift-card" {{ block.shopify_attributes }}>
                      <div class="velo-gift-card-badge">
                        {{ block.settings.value }} FREE
                      </div>
                      <div class="velo-gift-card-icon">
                        {% render 'velo-icons', icon: block.settings.icon %}
                      </div>
                      <div class="velo-gift-card-title">
                        <span class="velo-gift-card-free-text">FREE</span> {{ block.settings.title }}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            <!-- Urgency Banner -->
            {% if section.settings.urgency_text != blank %}
              <div class="velo-urgency">
                <span class="velo-urgency-dot"></span>
                <span>{{ section.settings.urgency_text | replace: '[date]', 'now' | date: "%B %d" }}</span>
              </div>
            {% endif %}

            <!-- Add to Cart Button -->
            <button
              type="submit"
              class="velo-atc-btn button button--full-width"
              {% unless current_product.available %}disabled{% endunless %}
            >
              {% if current_product.available %}
                {{ section.settings.atc_text | default: 'ADD TO CART +' }}
              {% else %}
                SOLD OUT
              {% endif %}
            </button>

            <!-- Trust Icons Below ATC -->
            <div class="velo-trust-icons">
              {% if section.settings.trust_1 != blank %}
                <div class="velo-trust-icon-item">
                  {% render 'velo-icons', icon: 'truck' %}
                  {{ section.settings.trust_1 }}
                </div>
              {% endif %}
              {% if section.settings.trust_2 != blank %}
                <div class="velo-trust-icon-item">
                  {% render 'velo-icons', icon: 'refresh' %}
                  {{ section.settings.trust_2 }}
                </div>
              {% endif %}
            </div>

            <!-- Payment Icons -->
            <div class="velo-payment-icons">
               {% for type in shop.enabled_payment_types %}
                 {{ type | payment_type_svg_tag: class: 'icon icon--full-color' }}
               {% endfor %}
               <!-- Fallback if shop has none setup yet in dev -->
               {% if shop.enabled_payment_types == empty %}
                  {{ 'visa' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'master' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'american_express' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'paypal' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'apple_pay' | payment_type_svg_tag: class: 'icon icon--full-color' }}
               {% endif %}
            </div>

            {% if section.settings.sub_desc != blank %}
              <div class="velo-sub-desc">
                {{ section.settings.sub_desc }}
              </div>
            {% endif %}

          {% endform %}
        {% else %}
          <!-- No product selected state -->
          <div class="velo-no-product">
            <p>Select a product in the theme editor to display it here.</p>
          </div>
          <button type="button" class="velo-atc-btn button button--full-width" disabled>
            ADD TO CART +
          </button>
        {% endif %}

        <!-- Accordions -->
        {%- assign accordion_blocks = section.blocks | where: 'type', 'accordion' -%}
        {% if accordion_blocks.size > 0 %}
          <div class="velo-accordions">
            {% for block in accordion_blocks %}
              <details class="velo-accordion" {{ block.shopify_attributes }}>
                <summary class="velo-accordion-trigger">
                  <span>{{ block.settings.title }}</span>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 8h12M8 2v12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </summary>
                <div class="velo-accordion-content">
                  {{ block.settings.content }}
                </div>
              </details>
            {% endfor %}
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>

<script src="{{ 'velo-product-hero.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "VELO Product Hero",
  "tag": "section",
  "class": "velo-section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "header",
      "content": "Demo Images (used if no product selected)"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Demo Image 1 (Featured)"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Demo Image 2"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Demo Image 3"
    },
    {
      "type": "header",
      "content": "Badges"
    },
    {
      "type": "text",
      "id": "badge_1",
      "label": "Badge 1",
      "default": "BESTSELLER"
    },
    {
      "type": "text",
      "id": "badge_2",
      "label": "Badge 2",
      "default": "#1 ACTIVE SITTING CHAIR"
    },
    {
      "type": "header",
      "content": "Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show review stars",
      "default": true
    },
    {
      "type": "range",
      "id": "rating_value",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating (stars)",
      "default": 5
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review count",
      "default": "140"
    },
    {
      "type": "header",
      "content": "Fallback Text (no product selected)"
    },
    {
      "type": "text",
      "id": "title_fallback",
      "label": "Product Title Fallback",
      "default": "VELO Freedom Chair"
    },
    {
      "type": "text",
      "id": "compare_price_fallback",
      "label": "Compare Price Fallback",
      "default": "$600.00"
    },
    {
      "type": "text",
      "id": "price_fallback",
      "label": "Sale Price Fallback",
      "default": "$397.00"
    },
    {
      "type": "text",
      "id": "save_amount_fallback",
      "label": "Save Amount Fallback",
      "default": "$203"
    },
    {
      "type": "header",
      "content": "Copy & Selling Points"
    },
    {
      "type": "text",
      "id": "trust_note",
      "label": "Trust Note (Lock)",
      "default": "Only available at [shop_name]"
    },
    {
      "type": "textarea",
      "id": "hero_desc",
      "label": "Product Description Snippet",
      "default": "The only chair that supports your body's natural need for movement - working with your body, not against it."
    },
    {
      "type": "text",
      "id": "bullet_1",
      "label": "Bullet Point 1",
      "default": "Energy: Prevents all-day sitting fatigue"
    },
    {
      "type": "text",
      "id": "bullet_2",
      "label": "Bullet Point 2",
      "default": "Focus: Boosts concentration and clarity"
    },
    {
      "type": "text",
      "id": "bullet_3",
      "label": "Bullet Point 3",
      "default": "Productivity: Increases daily work output"
    },
    {
      "type": "header",
      "content": "Gifts"
    },
    {
      "type": "text",
      "id": "gifts_heading",
      "label": "Gifts Section Heading",
      "default": "Limited Sale! Unlock FREE Gifts With Your Order"
    },
    {
      "type": "header",
      "content": "Urgency"
    },
    {
      "type": "text",
      "id": "urgency_text",
      "label": "Urgency Banner Text",
      "default": "Order by February 21st for guaranteed FREE Gifts"
    },
    {
      "type": "header",
      "content": "Button & Trust"
    },
    {
      "type": "text",
      "id": "atc_text",
      "label": "Add to Cart Button Text",
      "default": "ADD TO CART +"
    },
    {
      "type": "text",
      "id": "trust_1",
      "label": "Trust Text 1",
      "default": "Ships Today"
    },
    {
      "type": "text",
      "id": "trust_2",
      "label": "Trust Text 2",
      "default": "90-Day Easy Returns"
    },
    {
      "type": "richtext",
      "id": "sub_desc",
      "label": "Description below trust symbols",
      "default": "<p>VELO is made for people who need more than a standard chair. It's ideal for remote workers, creatives, people with ADHD, and... <a href=\"#\">Read More</a></p>"
    }
  ],
  "blocks": [
    {
      "type": "gift",
      "name": "Free Gift",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "package", "label": "Package" },
            { "value": "truck", "label": "Truck" },
            { "value": "shield", "label": "Shield" },
            { "value": "star", "label": "Star" },
            { "value": "monitor", "label": "Monitor" }
          ],
          "default": "package"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Item Name",
          "default": "Shipping"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value",
          "default": "($14)"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Benefits"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Experience the health benefits of active sitting.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "VELO Product Hero",
      "blocks": [
        { "type": "gift", "settings": { "icon": "package", "title": "Shipping", "value": "($14)" } },
        { "type": "gift", "settings": { "icon": "monitor", "title": "Mouse Pad", "value": "($23)" } },
        { "type": "gift", "settings": { "icon": "shield", "title": "Guarantee", "value": "($29)" } }
      ]
    }
  ]
}
{% endschema %}

