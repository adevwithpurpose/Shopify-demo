{{ 'kova-product-hero.css' | asset_url | stylesheet_tag }}

{%- assign current_product = section.settings.product -%}

<div class="kova-hero-wrapper">
  <div class="kova-hero-container page-width">
    <!-- Left Column: Media Gallery -->
    <div class="kova-media-gallery" id="KovaMediaGallery-{{ section.id }}">
      {% if current_product != blank and current_product.media.size > 0 %}
        <div class="kova-media-grid">
          {% for media in current_product.media %}
            <div class="kova-media-item {% if forloop.first %}kova-media-item--featured{% endif %}" data-media-id="{{ media.id }}">
              {% case media.media_type %}
                {% when 'image' %}
                  <img
                    src="{{ media | image_url: width: 800 }}"
                    alt="{{ media.alt | escape }}"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                    width="{{ media.width }}"
                    height="{{ media.height }}"
                    srcset="
                      {{ media | image_url: width: 400 }} 400w,
                      {{ media | image_url: width: 600 }} 600w,
                      {{ media | image_url: width: 800 }} 800w
                    "
                    sizes="(min-width: 990px) 50vw, 100vw"
                  >
                {% when 'video' %}
                  <div class="kova-video-wrapper">
                    {{ media | video_tag: autoplay: true, muted: true, loop: true, playsinline: true, controls: false }}
                  </div>
                {% when 'external_video' %}
                  <div class="kova-video-wrapper">
                    {{ media | external_video_url: autoplay: true, loop: true, mute: true | external_video_tag }}
                  </div>
              {% endcase %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- Placeholder images when no product selected (Demo Setup) -->
        <div class="kova-media-grid">
          <div class="kova-media-item kova-media-item--featured">
            <img src="https://images.unsplash.com/photo-1505693314120-0d443867891c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Mattress Topper 1" width="800" height="800" loading="eager" />
          </div>
          <div class="kova-media-item">
            <img src="https://images.unsplash.com/photo-1631679706909-1844bbd07221?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Mattress Topper 2" width="400" height="400" loading="lazy" />
          </div>
          <div class="kova-media-item">
            <img src="https://images.unsplash.com/photo-1540518614846-7eded433c457?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Mattress Topper 3" width="400" height="400" loading="lazy" />
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Right Column: Sticky Buy Box -->
    <div class="kova-buy-box" id="KovaBuyBox-{{ section.id }}">
      <div class="kova-buy-box-inner">
        <!-- Badges -->
        <div class="kova-badges">
          {% if section.settings.badge_1 != blank %}
            <span class="kova-badge kova-badge--primary">{{ section.settings.badge_1 }}</span>
          {% endif %}
          {% if section.settings.badge_2 != blank %}
            <span class="kova-badge kova-badge--secondary">{{ section.settings.badge_2 }}</span>
          {% endif %}
        </div>

        <!-- Review Stars -->
        {% if section.settings.show_reviews %}
          <div class="kova-rating">
            <div class="kova-stars">
              {% for i in (1..5) %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if i <= section.settings.rating_value %}#DDA75B{% else %}#E0E0E0{% endif %}">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              {% endfor %}
            </div>
            <span class="kova-rating-text">{{ section.settings.rating_value | append: ".0" }} | {{ section.settings.review_count }} reviews</span>
          </div>
        {% endif %}

        <!-- Product Title -->
        <h1 class="kova-product-title">
          {% if current_product != blank %}
            {{ current_product.title }}
          {% else %}
            {{ section.settings.title_fallback | default: 'K√ñVA Freedom Chair' }}
          {% endif %}
        </h1>

        <!-- Pricing -->
        <div class="kova-pricing">
          {% if current_product != blank %}
            {% if current_product.compare_at_price > current_product.price %}
              <span class="kova-price-compare">{{ current_product.compare_at_price | money }}</span>
            {% endif %}
            <span class="kova-price-current" id="KovaPrice-{{ section.id }}">{{ current_product.price | money }}</span>
            {% if current_product.compare_at_price > current_product.price %}
              {%- assign savings = current_product.compare_at_price | minus: current_product.price -%}
              <span class="kova-save-badge">SAVE {{ savings | money }}</span>
            {% endif %}
          {% else %}
            <span class="kova-price-compare">{{ section.settings.compare_price_fallback | default: '$600.00' }}</span>
            <span class="kova-price-current">{{ section.settings.price_fallback | default: '$397.00' }}</span>
            <span class="kova-save-badge">SAVE {{ section.settings.save_amount_fallback | default: '$203' }}</span>
          {% endif %}
        </div>

        <!-- Trust Note -->
        {% if section.settings.trust_note != blank %}
          <div class="kova-trust-note">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#DDA75B" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            {{ section.settings.trust_note | replace: '[shop_name]', shop.name }}
          </div>
        {% endif %}

        <!-- Product Description / Bullets -->
        <div class="kova-description-text">
          {{ section.settings.hero_desc | default: "The only chair that supports your body's natural need for movement - working with your body, not against it." }}
        </div>
        
        {% if section.settings.bullet_1 != blank or section.settings.bullet_2 != blank or section.settings.bullet_3 != blank %}
          <ul class="kova-bullets">
            {% if section.settings.bullet_1 != blank %}
              <li>
                <svg class="kova-check-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="10"/><path d="M6 10l3 3 5-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                {{ section.settings.bullet_1 }}
              </li>
            {% endif %}
            {% if section.settings.bullet_2 != blank %}
              <li>
                <svg class="kova-check-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="10"/><path d="M6 10l3 3 5-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                {{ section.settings.bullet_2 }}
              </li>
            {% endif %}
            {% if section.settings.bullet_3 != blank %}
              <li>
                <svg class="kova-check-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="10"/><path d="M6 10l3 3 5-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                {{ section.settings.bullet_3 }}
              </li>
            {% endif %}
          </ul>
        {% endif %}

        {% if current_product != blank %}
          {% form 'product', current_product %}
            
            <!-- Variant Selection -->
            {% unless current_product.has_only_default_variant %}
              <div class="kova-variants">
                {% for option in current_product.options_with_values %}
                  <div class="kova-option-group">
                    <label class="kova-option-label">{{ option.name }}: <span id="KovaOptionLabel-{{ section.id }}-{{ forloop.index0 }}">{{ option.selected_value }}</span></label>
                    <div class="kova-option-values">
                      {% for value in option.values %}
                        <label class="kova-swatch {% if option.selected_value == value %}kova-swatch--active{% endif %}" data-color="{{ value | escape }}">
                          <input
                            type="radio"
                            name="option-{{ option.name | handleize }}"
                            value="{{ value | escape }}"
                            {% if option.selected_value == value %}checked{% endif %}
                            data-option-index="{{ forloop.parentloop.index0 }}"
                            class="kova-swatch-input"
                          >
                          <span class="kova-swatch-inner"></span>
                        </label>
                      {% endfor %}
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endunless %}

            <input type="hidden" name="id" id="KovaVariantId-{{ section.id }}" value="{{ current_product.selected_or_first_available_variant.id }}">

            <!-- Variant JSON -->
            <script type="application/json" id="KovaVariantJson-{{ section.id }}">
              {{ current_product.variants | json }}
            </script>

            <!-- Free Gifts Section -->
            {%- assign gift_blocks = section.blocks | where: 'type', 'gift' -%}
            {% if gift_blocks.size > 0 %}
              <div class="kova-gifts">
                <h3 class="kova-gifts-heading">
                  {{ section.settings.gifts_heading | default: 'Limited Sale! Unlock FREE Gifts With Your Order' }}
                </h3>
                <div class="kova-gifts-grid">
                  {% for block in gift_blocks %}
                    <div class="kova-gift-card" {{ block.shopify_attributes }}>
                      <div class="kova-gift-card-top">
                        {% if block.settings.value != blank %}
                          <span class="kova-gift-card-value">{{ block.settings.value }}</span>
                        {% endif %}
                        <span class="kova-gift-card-free-tag">FREE</span>
                      </div>
                      <div class="kova-gift-card-icon">{{ block.settings.icon }}</div>
                      <div class="kova-gift-card-title">
                        <span class="kova-gift-card-free-text">FREE</span> {{ block.settings.title }}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            <!-- Urgency Banner -->
            {% if section.settings.urgency_text != blank %}
              <div class="kova-urgency">
                <span class="kova-urgency-dot"></span>
                <span>{{ section.settings.urgency_text | replace: '[date]', 'now' | date: "%B %d" }}</span>
              </div>
            {% endif %}

            <!-- Add to Cart Button -->
            <button
              type="submit"
              class="kova-atc-btn button button--full-width"
              {% unless current_product.available %}disabled{% endunless %}
            >
              {% if current_product.available %}
                {{ section.settings.atc_text | default: 'ADD TO CART +' }}
              {% else %}
                SOLD OUT
              {% endif %}
            </button>

            <!-- Trust Icons Below ATC -->
            <div class="kova-trust-icons">
              {% if section.settings.trust_1 != blank %}
                <div class="kova-trust-icon-item">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                  {{ section.settings.trust_1 }}
                </div>
              {% endif %}
              {% if section.settings.trust_2 != blank %}
                <div class="kova-trust-icon-item">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                  {{ section.settings.trust_2 }}
                </div>
              {% endif %}
            </div>

            <!-- Payment Icons -->
            <div class="kova-payment-icons">
               {% for type in shop.enabled_payment_types %}
                 {{ type | payment_type_svg_tag: class: 'icon icon--full-color' }}
               {% endfor %}
               <!-- Fallback if shop has none setup yet in dev -->
               {% if shop.enabled_payment_types == empty %}
                  {{ 'visa' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'master' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'american_express' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'paypal' | payment_type_svg_tag: class: 'icon icon--full-color' }}
                  {{ 'apple_pay' | payment_type_svg_tag: class: 'icon icon--full-color' }}
               {% endif %}
            </div>

            {% if section.settings.sub_desc != blank %}
              <div class="kova-sub-desc">
                {{ section.settings.sub_desc }}
              </div>
            {% endif %}

          {% endform %}
        {% else %}
          <!-- No product selected state -->
          <div class="kova-no-product">
            <p>Select a product in the theme editor to display it here.</p>
          </div>
          <button type="button" class="kova-atc-btn button button--full-width" disabled>
            ADD TO CART +
          </button>
        {% endif %}

        <!-- Accordions -->
        {%- assign accordion_blocks = section.blocks | where: 'type', 'accordion' -%}
        {% if accordion_blocks.size > 0 %}
          <div class="kova-accordions">
            {% for block in accordion_blocks %}
              <details class="kova-accordion" {{ block.shopify_attributes }}>
                <summary class="kova-accordion-trigger">
                  <span>{{ block.settings.title }}</span>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 8h12M8 2v12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </summary>
                <div class="kova-accordion-content">
                  {{ block.settings.content }}
                </div>
              </details>
            {% endfor %}
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>

<script src="{{ 'kova-product-hero.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "K√ñVA Product Hero",
  "tag": "section",
  "class": "kova-section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "header",
      "content": "Badges"
    },
    {
      "type": "text",
      "id": "badge_1",
      "label": "Badge 1",
      "default": "BESTSELLER"
    },
    {
      "type": "text",
      "id": "badge_2",
      "label": "Badge 2",
      "default": "#1 ACTIVE SITTING CHAIR"
    },
    {
      "type": "header",
      "content": "Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show review stars",
      "default": true
    },
    {
      "type": "range",
      "id": "rating_value",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Rating (stars)",
      "default": 5
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review count",
      "default": "140"
    },
    {
      "type": "header",
      "content": "Fallback Text (no product selected)"
    },
    {
      "type": "text",
      "id": "title_fallback",
      "label": "Product Title Fallback",
      "default": "K√ñVA Freedom Chair"
    },
    {
      "type": "text",
      "id": "compare_price_fallback",
      "label": "Compare Price Fallback",
      "default": "$600.00"
    },
    {
      "type": "text",
      "id": "price_fallback",
      "label": "Sale Price Fallback",
      "default": "$397.00"
    },
    {
      "type": "text",
      "id": "save_amount_fallback",
      "label": "Save Amount Fallback",
      "default": "$203"
    },
    {
      "type": "header",
      "content": "Copy & Selling Points"
    },
    {
      "type": "text",
      "id": "trust_note",
      "label": "Trust Note (Lock)",
      "default": "Only available at [shop_name]"
    },
    {
      "type": "textarea",
      "id": "hero_desc",
      "label": "Product Description Snippet",
      "default": "The only chair that supports your body's natural need for movement - working with your body, not against it."
    },
    {
      "type": "text",
      "id": "bullet_1",
      "label": "Bullet Point 1",
      "default": "Energy: Prevents all-day sitting fatigue"
    },
    {
      "type": "text",
      "id": "bullet_2",
      "label": "Bullet Point 2",
      "default": "Focus: Boosts concentration and clarity"
    },
    {
      "type": "text",
      "id": "bullet_3",
      "label": "Bullet Point 3",
      "default": "Productivity: Increases daily work output"
    },
    {
      "type": "header",
      "content": "Gifts"
    },
    {
      "type": "text",
      "id": "gifts_heading",
      "label": "Gifts Section Heading",
      "default": "Limited Sale! Unlock FREE Gifts With Your Order"
    },
    {
      "type": "header",
      "content": "Urgency"
    },
    {
      "type": "text",
      "id": "urgency_text",
      "label": "Urgency Banner Text",
      "default": "Order by February 21st for guaranteed FREE Gifts"
    },
    {
      "type": "header",
      "content": "Button & Trust"
    },
    {
      "type": "text",
      "id": "atc_text",
      "label": "Add to Cart Button Text",
      "default": "ADD TO CART +"
    },
    {
      "type": "text",
      "id": "trust_1",
      "label": "Trust Text 1",
      "default": "Ships Today"
    },
    {
      "type": "text",
      "id": "trust_2",
      "label": "Trust Text 2",
      "default": "90-Day Easy Returns"
    },
    {
      "type": "richtext",
      "id": "sub_desc",
      "label": "Description below trust symbols",
      "default": "<p>K√ñVA is made for people who need more than a standard chair. It's ideal for remote workers, creatives, people with ADHD, and... <a href=\"#\">Read More</a></p>"
    }
  ],
  "blocks": [
    {
      "type": "gift",
      "name": "Free Gift",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icon/Emoji",
          "default": "üì¶"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Item Name",
          "default": "Shipping"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Value",
          "default": "($14)"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Benefits"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Experience the health benefits of active sitting.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "K√ñVA Product Hero",
      "blocks": [
        { "type": "gift", "settings": { "icon": "üì¶", "title": "Shipping", "value": "($14)" } },
        { "type": "gift", "settings": { "icon": "üñ±Ô∏è", "title": "Mouse Pad", "value": "($23)" } },
        { "type": "gift", "settings": { "icon": "üî≤", "title": "Chair Mat", "value": "($49)" } },
        { "type": "gift", "settings": { "icon": "üõ°Ô∏è", "title": "Guarantee", "value": "($29)" } }
      ]
    }
  ]
}
{% endschema %}
